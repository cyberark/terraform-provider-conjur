# CyberArk Secrets Manager Provider

[![GitHub release](https://img.shields.io/github/release/cyberark/terraform-provider-conjur.svg)](https://github.com/cyberark/terraform-provider-conjur/releases/latest)

This provider manages authentication with CyberArk Secrets Manager, allowing Terraform to access and manage various Secrets Manager resources.

The provider can access the following Secrets Manager resources as data sources:
- [conjur_secret](./data-sources/secret.md)
- [conjur_certificate_issue](./data-sources/certificate_issue.md) (requires Secrets Manager Saas with Certificate Manager integration)
- [conjur_certificate_sign](./data-sources/certificate_sign.md) (requires Secrets Manager Saas with Certificate Manager integration)

The provider can also manage the following Secrets Manager resources:
- [conjur_authenticator](./resources/authenticator.md)
- [conjur_branch](./resources/branch.md)
- [conjur_host](./resources/host.md) (SaaS only)
- [conjur_group](./resources/group.md)
- [conjur_secret](./resources/secret.md) (SaaS only)
- [conjur_membership](./resources/membership.md)
- [conjur_permission](./resources/permission.md)

## Example Usage

### Using provider configuration attributes
```terraform
terraform {
  required_providers {
    conjur = {
      source  = "terraform.example.com/cyberark/conjur"
    }
  }
}

provider "conjur" {
  appliance_url = var.conjur_appliance_url
  account       = var.conjur_account
  authn_type    = var.conjur_authn_type
  login         = var.conjur_authn_login
  api_key       = var.conjur_api_key
  ssl_cert      = var.conjur_ssl_cert
}
```

### Using environment variables
Alternatively, the Terraform provider can read configuration from environment variables instead of provider attributes.
For example:
```sh
export CONJUR_APPLIANCE_URL="https://conjur-server"
export CONJUR_ACCOUNT="myorg"
export CONJUR_AUTHN_LOGIN="admin"
export CONJUR_AUTHN_API_KEY="3ahcddy39rcxzh3ggac4cwk3j2r8pqwdg33059y835ys2rh2kzs2a"
export CONJUR_CERT_FILE="/etc/conjur.pem"
```
In this scenario, the provider block can be left empty:
```terraform
terraform {
  required_providers {
    conjur = {
      source  = "cyberark/conjur"
    }
  }
}

provider "conjur" {}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Optional

- `account` (String) CyberArk Secrets Manager account
- `api_key` (String) CyberArk Secrets Manager API key
- `appliance_url` (String) CyberArk Secrets Manager endpoint URL
- `authn_jwt_token` (String) Authn JWT Token
- `authn_type` (String) CyberArk Secrets Manager Authentication Type
- `client_id` (String) Azure client ID for user assigned managed identity
- `host_id` (String) CyberArk Secrets Manager host ID
- `login` (String) CyberArk Secrets Manager login
- `service_id` (String) CyberArk Secrets Manager service ID
- `ssl_cert` (String) Content of CyberArk Secrets Manager public SSL certificate
- `ssl_cert_path` (String) Path to CyberArk Secrets Manager public SSL certificate

## Alternate Workflow with Summon

If this Terraform provider does not fit your needs, you can also use
[summon](https://github.com/cyberark/summon) with the
[summon-conjur](https://github.com/cyberark/summon-conjur) provider
to provide secrets to Terraform via environment variables.
The user running `terraform` must already be authenticated with CyberArk Secrets Manager.

Terraform's [`TF_VAR_name` syntax](https://www.terraform.io/docs/configuration/environment-variables.html#tf_var_name)
allows a user to set Terraform variables via environment variables.
To use Terraform with Summon, prefix the environment variable names in secrets.yml with `TF_VAR_`.

### Example

```terraform
# variables.tf
variable "access_key" {}
variable "secret_key" {}
```

```yaml
# secrets.yml
TF_VAR_access_key: !var aws/dev/sys_powerful/access_key_id
TF_VAR_secret_key: !var aws/dev/sys_powerful/secret_access_key
```

Run Terraform with Summon:

```sh-session
$ summon terraform apply
```