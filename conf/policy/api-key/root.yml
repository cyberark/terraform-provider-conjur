# Create a policy for the host
- !policy
  id: terraform
  owner: !host /data/testapp
  annotations:
    description: Policy for terraform
  body:
  - &variables
    - !variable target-password
  
  - !group consumers

  - !permit
    role: !group consumers
    privilege: [ read, execute ]
    resource: *variables

  # Child policy for the testapp user to manipulate
  - !policy 
    id: test
    body: 
    - !host test-workload
    - !variable workload-secret

  - !permit 
    role: !host /data/testapp
    privileges: [ read, update, create, delete ]
    resource: !policy test
