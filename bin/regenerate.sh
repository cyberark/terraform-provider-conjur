#!/bin/bash

docker build -f Dockerfile.tools -t tools .

docker run --rm -it -v "$PWD":/app -w /app tools bash -c "
  echo 'Running go generate...'
  go generate ./...

  # Mockery skips the Conjur client interface because it is generated. Remove the code comment to avoid this.
  find ./internal/conjur -name '*.gen.go' -exec sed -i '1{/^\/\/ Code generated by interfacer; DO NOT EDIT/d;}' {} +

  echo 'Running mockery...'
  mockery"
